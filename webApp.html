<html>
    <head>
        <meta charset="utf-8"/>
        <meta name = "viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"/>
        <title> Intern Bridge QAQC WebApp</title>

        <!-- SET ESRI CSS SOURCE -->
        <link rel="stylesheet" href="https://js.arcgis.com/4.26/esri/themes/light/main.css"/>
        
        <!-- SET ESRI JS API SOURCE -->
        <script src="https://js.arcgis.com/4.26/"></script>
        
        <!-- CSS IN A STYLE TAG -->
        <style>
            html,
            body,
            #viewDiv {
                padding: 0;
                margin: 0;
                height: 100%;
                width: 100%;
            }

            #layerToggle {
                top: 20px;
                right: 20px;
                position: absolute;
                z-index: 99;
                background-color: white;
                border-radius: 8px;
                padding: 10px;
                opacity: 0.75;
            }

            #layerToggle2 {
                top: 70px;
                right: 20px;
                position: absolute;
                z-index: 99;
                background-color: white;
                border-radius: 8px;
                padding: 10px;
                opacity: 0.75;
            }

            #layerToggle3 {
                top: 120px;
                right: 20px;
                position: absolute;
                z-index: 99;
                background-color: white;
                border-radius: 8px;
                padding: 10px;
                opacity: 0.75;
            }
        </style>

        <!-- JS IN A SCRIPT TAG-->
        <script>
            // REQUIRE STATEMENT LOADS INDIVIDUAL ESRI MODULES
            require(
                [
                    // MAP AND MAPVIEW
                    "esri/config",
                    "esri/Map",
                    "esri/views/MapView",
                    "esri/Basemap",

                    // LAYERS
                    "esri/layers/FeatureLayer",
                    "esri/layers/TileLayer",
                    "esri/layers/WMTSLayer",
                    
                    // WIDGETS
                    "esri/widgets/Editor"
                ],

                //LOAD MODULES INTO FUNCTION FOR USE IN THE APP
                function(esriConfig, Map, MapView, Basemap, FeatureLayer, TileLayer, WMTSLayer, Editor) {


                // HAVE TO HAVE API KEY TO ACCESS ARCGIS SERVICES
                esriConfig.apiKey = "AAPK47940bdbad24479c8e5cfc3285632cf0D6SI_0gce6ZC0zx7iGkSeVP7k66w2b23CD8OKRR1jRMFulXcBwmgjXjgUHmhXMNS";

                // CREATE WMTS BASEMAP FOR TEXAS 6 INCH IMAGERY
                const TISBasemap = new Basemap({
                    baseLayers: [
                        new WMTSLayer({
                            url: "https://txgi.tnris.org/login/path/food-paul-zebra-shirt/wmts/1.0.0/WMTSCapabilities.xml",
                            activeLayer: {
                                id: "texas"
                            }
                        })  
                    ]
                });


                //CREATE MAP WITH IMAGERY BASEMAP
                const map = new Map({
                    //basemap: "arcgis-imagery" // CHANGING TO IMAGERY
                    basemap : TISBasemap // NOW IT IS THE TEXAS IMAGERY SERVICE LAYER
                });


                // CREATE MAPVIEW
                const mapView = new MapView({
                    map: map,
                    center: [-100.341389, 31.132222],
                    zoom: 6,
                    container: "viewDiv"
                });

                // CONSTRUCT FEATURELAYERS

                //ROADWAYS
                const roadways = new FeatureLayer({
                    url: "https://services.arcgis.com/KTcxiTD9dsQw4r7Z/arcgis/rest/services/TxDOT_Roadways/FeatureServer/0",
                    id: "roadways",
                    visible: true
                });

                // BRIDGE RENDERER (SYMBOLOGY) AND BRIDGE LAYER
                const bridgesRenderer = {
                    type: "simple",
                    symbol: {
                        type: "simple-fill",
                        style: "solid",
                        color: "#73B2FF",
                        outline: {
                            color: "#5E5E5E",
                            width: 1
                        }
                    }
                };

                const bridgeTest = new FeatureLayer({
                    //THIS IS A TEST COPY LAYER, USING UT AUSTIN AGO
                    url: "https://services1.arcgis.com/7DRakJXKPEhwv0fM/arcgis/rest/services/bridgehull_testcopy/FeatureServer/0",
                    renderer: bridgesRenderer,
                    opacity: 0.5
                });

                // STREAMS
                const streams = new FeatureLayer ({
                    url: "https://services.arcgis.com/KTcxiTD9dsQw4r7Z/arcgis/rest/services/Texas_Streams/FeatureServer",
                    id: "streams",
                    visible: true
                });
                

                // BRIDGE POINTS
                const nbiRenderer = {
                    type: "simple",
                    symbol: {
                        type: "simple-marker",
                        size: 5,
                        color: "red"
                    }
                };

                const nbiPoints = new FeatureLayer ({
                    url: "https://services.arcgis.com/KTcxiTD9dsQw4r7Z/arcgis/rest/services/TxDOT_Bridges/FeatureServer",
                    renderer: nbiRenderer,
                    id: "nbiPoints", 
                    visible: true
                });

                // ADD FEATURELAYER TO THE MAP
                map.add(roadways);
                map.add(bridgeTest);
                map.add(streams);
                map.add(nbiPoints);

                // CREATE VARIABLE REFERENCING THE CHECKBOX NODE 
                const streamsLayerToggle = document.getElementById("streams");
                const roadwaysLayerToggle = document.getElementById("roadways");
                const nbiLayerToggle = document.getElementById("nbiPoints");

                // LISTEN TO THE CHANGE EVENT FOR THE CHECKBOX
                streamsLayerToggle.addEventListener("change", () => {
                    // WHEN CHECKBOX IS UNCHECKED (TRUE), SET VISIBILITY TO TRUE
                    streams.visible = streamsLayerToggle.checked;
                });

                roadwaysLayerToggle.addEventListener("change", () => {
                    // WHEN CHECKBOX IS UNCHECKED (TRUE), SET VISIBILITY TO TRUE
                    roadways.visible = roadwaysLayerToggle.checked;
                });

                nbiLayerToggle.addEventListener("change", () => {
                    // WHEN CHECKBOX IS UNCHECKED (TRUE), SET VISIBILITY TO TRUE
                    nbiPoints.visible = nbiLayerToggle.checked;
                });


                // // SET UP EDITABLE LAYERS
                // mapView.map.editableLayers.forEach((layer) => {
                //     if (layer.type === 'feature') {
                //         switch (layer.geometryType) {
                //             case "polygon":
                //                 polygonLayer = layer;
                //                 break;
                //             case "polyline":
                //                 lineLayer = layer;
                //                 break;
                //             case "point":
                //                 pointLayer = layer;
                //                 break;
                //         }
                //     }
                // });

                // // SET BRIDGE LAYER'S LAYERINFO
                // const bridgeInfos = {
                //     layer: bridgeTest,
                //     formTemplate: { // AUTOCASTS TO FORMTEMPLATE
                //         elements: [{ // AUTOCASTS TO FIELD ELEMENTS
                //             type: "field",
                //             fieldName: "IS_IRREG",
                //             label: "Is Irregular"
                //         }]
                //     }
                // };



                // // EDITOR WIDGET
                // const editor = new Editor({
                //     view: mapView,
                //     layerInfos: [bridgeInfos]
                // });

                // //ADD WIDGET TO THE VIEW
                // mapView.ui.add(editor, "bottom-left");

            });
        </script>
    </head>

    <!--- AFTER THE HEAD COMES THE BODY WITHIN THE HTML BRACES-->
    <body>
        <div id="viewDiv"></div>
        <span id="layerToggle" class="esri-widget"> <input type="checkbox" id="streams" checked /> Streams </span>
        <span id="layerToggle2" class="esri-widget"> <input type="checkbox" id="roadways" checked /> Roadways </span>
        <span id="layerToggle3" class="esri-widget"> <input type="checkbox" id="nbiPoints" checked /> Bridge Points </span>
    </body>
</html>